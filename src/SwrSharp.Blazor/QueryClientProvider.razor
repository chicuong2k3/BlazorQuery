@implements IAsyncDisposable

<CascadingValue Value="@_resolvedClient">
    @ChildContent
</CascadingValue>

@code {
    [Parameter] public RenderFragment? ChildContent { get; set; }

    /// <summary>
    /// Optional explicit QueryClient. If not provided, uses the DI-registered client.
    /// </summary>
    [Parameter] public QueryClient? Client { get; set; }

    [Inject] private QueryClient InjectedClient { get; set; } = null!;
    [Inject] private BrowserFocusManager FocusManager { get; set; } = null!;
    [Inject] private BrowserOnlineManager OnlineManager { get; set; } = null!;

    private QueryClient _resolvedClient = null!;
    private bool _initialized;

    protected override void OnInitialized()
    {
        _resolvedClient = Client ?? InjectedClient;
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender && !_initialized)
        {
            _initialized = true;
            await FocusManager.InitializeAsync();
            await OnlineManager.InitializeAsync();
        }
    }

    public async ValueTask DisposeAsync()
    {
        await FocusManager.DisposeAsync();
        await OnlineManager.DisposeAsync();
    }
}
