<!DOCTYPE html>
<html lang="en" class="dark">

<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <base href="/"/>
    <title>SwrSharp - Blazor Data Fetching</title>
    <script src="https://cdn.tailwindcss.com?plugins=typography"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#fef2f2',
                            100: '#fee2e2',
                            200: '#fecaca',
                            300: '#fca5a5',
                            400: '#f87171',
                            500: '#ef4444',
                            600: '#dc2626',
                            700: '#b91c1c',
                            800: '#991b1b',
                            900: '#7f1d1d',
                        }
                    },
                    typography: (theme) => ({
                        DEFAULT: {
                            css: {
                                maxWidth: 'none',
                            }
                        },
                        invert: {
                            css: {
                                '--tw-prose-body': theme('colors.gray[300]'),
                                '--tw-prose-headings': theme('colors.white'),
                                '--tw-prose-links': theme('colors.red[400]'),
                                '--tw-prose-bold': theme('colors.white'),
                                '--tw-prose-counters': theme('colors.gray[400]'),
                                '--tw-prose-bullets': theme('colors.gray[600]'),
                                '--tw-prose-hr': theme('colors.gray[700]'),
                                '--tw-prose-quotes': theme('colors.gray[100]'),
                                '--tw-prose-quote-borders': theme('colors.gray[700]'),
                                '--tw-prose-captions': theme('colors.gray[400]'),
                                '--tw-prose-code': theme('colors.red[300]'),
                                '--tw-prose-pre-code': theme('colors.gray[200]'),
                                '--tw-prose-pre-bg': theme('colors.gray[900]'),
                                '--tw-prose-th-borders': theme('colors.gray[600]'),
                                '--tw-prose-td-borders': theme('colors.gray[700]'),
                                'code': {
                                    backgroundColor: theme('colors.gray[800]'),
                                    padding: '0.25rem 0.375rem',
                                    borderRadius: '0.25rem',
                                    fontWeight: '400',
                                },
                                'code::before': {
                                    content: '""'
                                },
                                'code::after': {
                                    content: '""'
                                },
                                'pre': {
                                    backgroundColor: 'rgba(0, 0, 0, 0.3)',
                                    border: `1px solid ${theme('colors.gray[800]')}`,
                                    borderRadius: '0.5rem',
                                },
                                'pre code': {
                                    backgroundColor: 'transparent',
                                    padding: '0',
                                    borderRadius: '0',
                                },
                                'blockquote': {
                                    borderLeftWidth: '4px',
                                    borderLeftColor: theme('colors.blue[500]'),
                                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                                    paddingTop: '0.5rem',
                                    paddingBottom: '0.5rem',
                                    paddingLeft: '1rem',
                                    paddingRight: '1rem',
                                    borderRadius: '0 0.25rem 0.25rem 0',
                                }
                            }
                        }
                    })
                },
            },
        }
    </script>

    <!-- Prism.js for syntax highlighting (dark theme) -->
    <link href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />

    <style>
        /* Custom scrollbar for dark theme */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #0d1117;
        }
        ::-webkit-scrollbar-thumb {
            background: #30363d;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #484f58;
        }

        /* Responsive images in prose content */
        .prose img {
            max-width: 100%;
            height: auto;
        }

        /* Responsive tables - horizontal scroll */
        .prose table {
            display: block;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        /* Code blocks don't overflow on mobile */
        .prose pre {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        /* Prevent long inline code from breaking layout */
        .prose code {
            word-break: break-word;
        }
        .prose pre code {
            word-break: normal;
        }

        /* Override Prism theme to match our dark background */
        .prose pre[class*="language-"],
        .prose code[class*="language-"] {
            background: transparent !important;
            text-shadow: none !important;
            font-size: 0.8125rem !important; /* 13px - same as body text */
            line-height: 1.6 !important;
        }
        pre[class*="language-"] {
            background: rgba(0, 0, 0, 0.3) !important;
            border: 1px solid #30363d !important;
            border-radius: 0.5rem !important;
            margin: 0 !important;
            padding: 1rem !important;
            font-size: 0.8125rem !important; /* 13px */
        }
        
        /* Code font size to match document text */
        .prose pre code,
        .prose code {
            font-size: 0.8125rem !important; /* 13px - same as body text */
            font-family: ui-monospace, SFMono-Regular, 'SF Mono', Menlo, Consolas, monospace !important;
            line-height: 1.6 !important;
        }
        
        /* Inline code same size as surrounding text */
        .prose :not(pre) > code {
            font-size: 0.875em !important; /* relative to parent */
            padding: 0.125rem 0.375rem !important;
        }

        /* Code block wrapper (for copy button positioning) */
        .code-block-wrapper {
            position: relative;
        }

        /* Language label */
        .code-lang-label {
            position: absolute;
            top: 0;
            left: 1rem;
            background: #21262d;
            color: #8b949e;
            font-size: 0.7rem;
            padding: 0.15rem 0.5rem;
            border-radius: 0 0 0.25rem 0.25rem;
            font-family: ui-monospace, monospace;
            z-index: 1;
        }

        /* Copy button for code blocks */
        .copy-code-btn {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: #21262d;
            border: 1px solid #30363d;
            color: #8b949e;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.7rem;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.2s, background 0.2s, color 0.2s;
            z-index: 2;
        }
        .code-block-wrapper:hover .copy-code-btn {
            opacity: 1;
        }
        .copy-code-btn:hover {
            background: #30363d;
            color: #e6edf3;
        }
        .copy-code-btn.copied {
            color: #3fb950;
            opacity: 1;
        }
    </style>

    <HeadOutlet/>
</head>

<body class="bg-[#0d1117] font-sans text-gray-300 antialiased">
<Routes/>

<!-- Prism.js core + common languages -->
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/prism.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>

<script>
    // Map common language aliases to Prism names
    const langMap = {
        'cs': 'csharp', 'c#': 'csharp',
        'js': 'javascript',
        'ts': 'typescript', 'tsx': 'typescript',
        'sh': 'bash', 'shell': 'bash', 'zsh': 'bash',
        'yml': 'yaml',
        'py': 'python',
        'rb': 'ruby',
        'md': 'markdown',
        'html': 'markup', 'xml': 'markup', 'svg': 'markup',
        'razor': 'cshtml'
    };

    // Initialize code blocks: highlight + add copy button + language label
    window.initCodeBlocks = function () {
        document.querySelectorAll('.prose pre code').forEach(function (codeEl) {
            var pre = codeEl.parentElement;
            // Skip already processed
            if (pre.parentElement && pre.parentElement.classList.contains('code-block-wrapper')) return;

            // Detect language from class
            var lang = '';
            var classes = codeEl.className || '';
            var match = classes.match(/language-(\S+)/);
            if (match) {
                lang = match[1];
            }

            // Map alias
            var prismLang = langMap[lang] || lang;

            // Add Prism class if not present
            if (prismLang && !codeEl.classList.contains('language-' + prismLang)) {
                codeEl.className = 'language-' + prismLang;
                pre.className = 'language-' + prismLang;
            }

            // Wrap in container for positioning
            var wrapper = document.createElement('div');
            wrapper.className = 'code-block-wrapper';
            pre.parentNode.insertBefore(wrapper, pre);
            wrapper.appendChild(pre);

            // Language label
            if (lang) {
                var label = document.createElement('span');
                label.className = 'code-lang-label';
                label.textContent = lang;
                wrapper.appendChild(label);
            }

            // Copy button
            var btn = document.createElement('button');
            btn.className = 'copy-code-btn';
            btn.innerHTML = '&#x2398; Copy';
            btn.addEventListener('click', function () {
                var text = codeEl.textContent;
                navigator.clipboard.writeText(text).then(function () {
                    btn.textContent = '\u2713 Copied!';
                    btn.classList.add('copied');
                    setTimeout(function () {
                        btn.innerHTML = '&#x2398; Copy';
                        btn.classList.remove('copied');
                    }, 2000);
                });
            });
            wrapper.appendChild(btn);
        });

        // Run Prism highlight
        if (window.Prism) {
            Prism.highlightAll();
        }
    };

    // Copy full page text content
    window.copyPageContent = function () {
        var article = document.querySelector('article');
        if (!article) return false;
        var text = article.innerText;
        navigator.clipboard.writeText(text);
        return true;
    };

    // Initialize Copy Page button
    function initCopyPageButton() {
        var btn = document.getElementById('copy-page-btn');
        if (!btn || btn.dataset.initialized) return;
        btn.dataset.initialized = 'true';
        
        btn.addEventListener('click', function() {
            if (window.copyPageContent()) {
                var original = btn.textContent;
                btn.textContent = 'âœ“ Copied!';
                btn.classList.add('text-green-400');
                setTimeout(function() {
                    btn.textContent = original;
                    btn.classList.remove('text-green-400');
                }, 2000);
            }
        });
    }

    // Search modal functionality
    var searchModal = null;
    var searchInput = null;
    var searchResults = null;
    var searchData = [];
    var selectedIndex = 0;

    function createSearchModal() {
        if (document.getElementById('search-modal')) return;
        
        var modal = document.createElement('div');
        modal.id = 'search-modal';
        modal.className = 'fixed inset-0 z-50 hidden';
        modal.innerHTML = `
            <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="closeSearchModal()"></div>
            <div class="absolute top-[10%] left-1/2 -translate-x-1/2 w-full max-w-2xl px-4">
                <div class="bg-[#0d1117] border border-[#21262d] rounded-xl shadow-2xl overflow-hidden">
                    <div class="flex items-center px-4 border-b border-[#21262d]">
                        <svg class="w-5 h-5 text-gray-500 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                        </svg>
                        <input id="search-modal-input" type="text" placeholder="Search documentation..." 
                               class="flex-1 px-3 py-4 bg-transparent text-white placeholder-gray-500 focus:outline-none text-base">
                        <kbd class="px-2 py-1 text-xs text-gray-500 bg-[#161b22] rounded border border-[#21262d]">ESC</kbd>
                    </div>
                    <div id="search-results" class="max-h-[60vh] overflow-y-auto">
                        <div class="px-4 py-8 text-center text-gray-500 text-sm">
                            Type to search documentation...
                        </div>
                    </div>
                </div>
            </div>
        `;
        document.body.appendChild(modal);
        
        searchModal = modal;
        searchInput = document.getElementById('search-modal-input');
        searchResults = document.getElementById('search-results');
        
        searchInput.addEventListener('input', debounce(performSearch, 150));
        searchInput.addEventListener('keydown', handleSearchKeydown);
    }

    function loadSearchData() {
        searchData = [];
        document.querySelectorAll('nav a[href^="/docs/"]').forEach(function(link) {
            var section = link.closest('div');
            var category = section ? (section.querySelector('h3') || {}).textContent || 'Docs' : 'Docs';
            searchData.push({
                title: link.textContent.trim(),
                url: link.getAttribute('href'),
                category: category.trim()
            });
        });
    }

    window.openSearchModal = function() {
        createSearchModal();
        loadSearchData();
        searchModal.classList.remove('hidden');
        searchInput.value = '';
        searchInput.focus();
        selectedIndex = 0;
        document.body.style.overflow = 'hidden';
    };

    window.closeSearchModal = function() {
        if (searchModal) {
            searchModal.classList.add('hidden');
            document.body.style.overflow = '';
        }
    };

    function performSearch() {
        var query = searchInput.value.toLowerCase().trim();
        selectedIndex = 0;
        
        if (!query) {
            searchResults.innerHTML = '<div class="px-4 py-8 text-center text-gray-500 text-sm">Type to search documentation...</div>';
            return;
        }

        var results = searchData.filter(function(item) {
            return item.title.toLowerCase().includes(query) || item.category.toLowerCase().includes(query);
        });

        if (results.length === 0) {
            searchResults.innerHTML = '<div class="px-4 py-8 text-center text-gray-500 text-sm">No results found for "' + query + '"</div>';
            return;
        }

        searchResults.innerHTML = results.map(function(item, i) {
            var highlighted = item.title.replace(new RegExp('(' + escapeRegex(query) + ')', 'gi'), '<span class="text-red-400 font-semibold">$1</span>');
            return '<a href="' + item.url + '" class="search-result flex items-center px-4 py-3 hover:bg-[#161b22] transition ' + (i === 0 ? 'bg-[#161b22]' : '') + '" data-index="' + i + '">' +
                '<div class="flex-1"><div class="text-white text-sm">' + highlighted + '</div><div class="text-gray-500 text-xs mt-0.5">' + item.category + '</div></div>' +
                '<svg class="w-4 h-4 text-gray-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg></a>';
        }).join('');
    }

    function handleSearchKeydown(e) {
        var results = searchResults.querySelectorAll('.search-result');
        if (results.length === 0) return;

        if (e.key === 'ArrowDown') {
            e.preventDefault();
            selectedIndex = Math.min(selectedIndex + 1, results.length - 1);
            updateSelection(results);
        } else if (e.key === 'ArrowUp') {
            e.preventDefault();
            selectedIndex = Math.max(selectedIndex - 1, 0);
            updateSelection(results);
        } else if (e.key === 'Enter') {
            e.preventDefault();
            if (results[selectedIndex]) {
                window.location.href = results[selectedIndex].getAttribute('href');
            }
        }
    }

    function updateSelection(results) {
        results.forEach(function(el, i) {
            if (i === selectedIndex) {
                el.classList.add('bg-[#161b22]');
                el.scrollIntoView({ block: 'nearest' });
            } else {
                el.classList.remove('bg-[#161b22]');
            }
        });
    }

    function escapeRegex(str) {
        return str.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
    }

    function debounce(fn, ms) {
        var timeout;
        return function() {
            var args = arguments;
            clearTimeout(timeout);
            timeout = setTimeout(function() { fn.apply(null, args); }, ms);
        };
    }

    // Initialize search triggers
    function initSearchTriggers() {
        // Click on search input opens modal
        document.querySelectorAll('input[placeholder*="Search"]').forEach(function(input) {
            if (input.dataset.searchInit) return;
            input.dataset.searchInit = 'true';
            input.addEventListener('click', function(e) {
                e.preventDefault();
                openSearchModal();
            });
            input.addEventListener('focus', function(e) {
                e.preventDefault();
                this.blur();
                openSearchModal();
            });
        });
    }

    // Keyboard shortcut Cmd/Ctrl + K
    document.addEventListener('keydown', function(e) {
        if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
            e.preventDefault();
            openSearchModal();
        }
        if (e.key === 'Escape') {
            closeSearchModal();
        }
    });

    // Initialize all on page load and Blazor navigation
    function initAll() {
        initCopyPageButton();
        initSearchTriggers();
        window.initCodeBlocks();
    }

    // Run on DOM ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initAll);
    } else {
        initAll();
    }

    // Re-run after Blazor navigation
    document.addEventListener('DOMContentLoaded', function() {
        // MutationObserver for SPA navigation
        var observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                if (mutation.addedNodes.length) {
                    setTimeout(initAll, 100);
                }
            });
        });
        var main = document.querySelector('body');
        if (main) {
            observer.observe(main, { childList: true, subtree: true });
        }
    });
</script>
</body>

</html>
