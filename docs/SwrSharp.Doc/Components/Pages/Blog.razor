@page "/blog"
@page "/blog/{fileName}"
@using BlazorStatic.Services
@inject BlazorStaticContentService<BlogFrontMatter> BlazorStaticContentService


@* No filename -> show latest posts *@
@if (string.IsNullOrWhiteSpace(FileName))
{
    <div class="divide-y divide-gray-700">
        <div class="space-y-2 pb-8 pt-6 md:space-y-5">
            <H1>Latest</H1>
            <p class="text-lg leading-7 text-gray-400 prose prose-invert">@WebsiteKeys.BlogLead</p>
        </div>

        <PostsList/>
    </div>
    return;
}

@* Show specific post by filename param *@
@if (_post == null)
{
    <div>Post not found ü§∑ </div>
    return;
}
<article>
    <div class="xl:divide-y  xl:divide-gray-700">
        <header class="pt-6 xl:pb-6">
            <div class="space-y-1 text-center">

                <dl class="space-y-2">
                    <DateRow Published="_post.FrontMatter.Published" Updated="_post.FrontMatter.Updated"/>
                </dl>

                <H1> @_post.FrontMatter.Title</H1>
            </div>
        </header>
        <div
            class="grid-rows-[auto_1fr] divide-y  pb-8 divide-gray-700 xl:grid xl:grid-cols-4 xl:gap-x-6 xl:divide-y-0">

            <dl class="pb-10 pt-6 xl:border-b  xl:pt-11 xl:border-gray-700">
                <dt class="sr-only">Authors</dt>
                <dd>
                    <ul class="flex flex-wrap justify-center gap-4 sm:space-x-12 xl:block xl:space-x-0 xl:space-y-8">
                        @foreach (var author in _post.FrontMatter.Authors)
                        {
                            <li class="flex items-center space-x-2">
                                <dl class="whitespace-nowrap text-sm font-medium leading-5">
                                    @if (!string.IsNullOrWhiteSpace(author.Name))
                                    {
                                        <dt class="sr-only">Name</dt>
                                        <dd class="text-gray-900 dark:text-gray-100 flex gap-1 items-center">
                                            @author.Name
                                            @if (!string.IsNullOrWhiteSpace(author.XUserName))
                                            {
                                                <a target="_blank" rel="noopener noreferrer" href="https://x.com/@author.XUserName"
                                                   class="flex gap-1 text-primary-500 hover:text-primary-600 dark:hover:text-primary-400">
                                                    <Svg SizeClasses="w-4 h-4" Icon="Svg.Icons.X"/>
                                                </a>
                                            }
                                            @if (!string.IsNullOrWhiteSpace(author.GitHubUserName))
                                            {
                                                <a target="_blank" rel="noopener noreferrer"
                                                   href="https://github.com/@author.GitHubUserName"
                                                   class="flex gap-1 items-center text-primary-500 hover:text-primary-600 dark:hover:text-primary-400">
                                                    <Svg SizeClasses="w-4 h-4" Icon="Svg.Icons.Github"/>
                                                </a>
                                            }
                                        </dd>
                                    }
                                </dl>
                            </li>
                        }
                    </ul>
                </dd>
            </dl>
            <div class="divide-y  divide-gray-700 xl:col-span-3 xl:row-span-2 xl:pb-0">
                <div class="prose prose-invert max-w-none pb-8 pt-10">
                    @((MarkupString)_post.HtmlContent)
                </div>
                <div class="pb-6 pt-6 text-sm text-gray-300">
                    <a target="_blank" rel="noopener noreferrer"
                       href="@($"{WebsiteKeys.BlogPostStorageAddress}/{FileName}")">
                        View on GitHub
                    </a>
                </div>
            </div>
            <footer>
                <div class=" text-sm font-medium leading-5 divide-gray-700 xl:col-start-1 xl:row-start-2 xl:divide-y">
                    <div class="py-4 xl:py-8">
                        <h2 class="text-xs uppercase tracking-wide text-gray-400">Tags</h2>
                        <TagsComponent Tags="_post.FrontMatter.Tags"/>
                    </div>
                </div>
                <div class="pt-4 xl:pt-8">
                    <a class="text-primary-500 hover:text-primary-400" aria-label="Back to the home" href="">
                        ‚Üê Back to
                        the home
                    </a>
                </div>
            </footer>
        </div>
    </div>
</article>


@code {
    [Parameter] public string? FileName { get; set; }
    Post<BlogFrontMatter>? _post;

    protected override void OnInitialized()
    {
        if (string.IsNullOrWhiteSpace(FileName)) return;
        _post = BlazorStaticContentService.Posts.FirstOrDefault(x => x.Url == FileName);
    }

}