@layout MainLayout

@page "/docs/getting-started/{**route}"
@page "/docs/guides/{**route}"
@page "/docs/concepts/{**route}"
@page "/docs/api/{**route}"
@using BlazorStatic
@using BlazorStatic.Services
@inject BlazorStaticContentService<DocFrontMatter> ContentService

<article class="ml-64 max-w-4xl mx-auto px-8 py-12">
    @if (Post == null)
    {
        <div class="text-center py-12">
            <h1 class="text-2xl font-bold text-white">Page not found</h1>
            <p class="text-gray-400 mt-2">The documentation page you're looking for doesn't exist.</p>
            <a href="/docs/getting-started/overview" class="text-red-400 hover:text-red-300 mt-4 inline-block">
                ← Back to Overview
            </a>
        </div>
    }
    else
    {
        <div class="mb-8">
            <p class="text-xs text-gray-500 mb-3 uppercase tracking-wider">@Post.FrontMatter.Category</p>
            <h1 class="text-5xl font-bold text-white mb-4 leading-tight">@Post.FrontMatter.Title</h1>
        </div>

        <div class="prose prose-invert prose-lg max-w-none 
                    prose-headings:text-white prose-headings:font-bold 
                    prose-h1:text-4xl prose-h1:mb-6 prose-h1:mt-12
                    prose-h2:text-3xl prose-h2:mb-4 prose-h2:mt-10
                    prose-h3:text-2xl prose-h3:mb-3 prose-h3:mt-8
                    prose-p:text-gray-300 prose-p:leading-relaxed prose-p:mb-4
                    prose-a:text-red-400 prose-a:no-underline hover:prose-a:text-red-300 hover:prose-a:underline
                    prose-strong:text-white prose-strong:font-semibold
                    prose-code:text-red-300 prose-code:bg-gray-800 prose-code:px-1.5 prose-code:py-0.5 prose-code:rounded prose-code:text-sm
                    prose-pre:bg-black/30 prose-pre:border prose-pre:border-gray-800 prose-pre:rounded-lg
                    prose-blockquote:border-l-4 prose-blockquote:border-blue-500 prose-blockquote:bg-blue-500/10 prose-blockquote:py-2 prose-blockquote:px-4 prose-blockquote:rounded-r
                    prose-ul:text-gray-300 prose-ol:text-gray-300
                    prose-li:my-1">
            @((MarkupString)Post.HtmlContent)
        </div>

        <div class="mt-16 pt-8 border-t border-gray-800">
            <div class="flex justify-between items-center">
                @if (PreviousPost != null)
                {
                    <a href="@PreviousPost.Url" class="group flex items-center text-gray-400 hover:text-white transition">
                        <span class="text-2xl mr-2 group-hover:-translate-x-1 transition-transform">←</span>
                        <div>
                            <div class="text-xs text-gray-500 uppercase tracking-wider mb-1">Previous</div>
                            <div class="font-medium">@PreviousPost.FrontMatter.Title</div>
                        </div>
                    </a>
                }
                else
                {
                    <div></div>
                }

                @if (NextPost != null)
                {
                    <a href="@NextPost.Url" class="group flex items-center text-gray-400 hover:text-white transition text-right">
                        <div>
                            <div class="text-xs text-gray-500 uppercase tracking-wider mb-1">Next</div>
                            <div class="font-medium">@NextPost.FrontMatter.Title</div>
                        </div>
                        <span class="text-2xl ml-2 group-hover:translate-x-1 transition-transform">→</span>
                    </a>
                }
            </div>
        </div>
    }
</article>

@code {
    [Parameter]
    public string Route { get; set; } = "";

    private Post<DocFrontMatter>? Post { get; set; }
    private Post<DocFrontMatter>? PreviousPost { get; set; }
    private Post<DocFrontMatter>? NextPost { get; set; }

    protected override void OnInitialized()
    {
        // Build the URL based on the route
        var url = $"/docs/{Route}";
        
        // Find the post
        Post = ContentService.Posts.FirstOrDefault(p => p.Url.EndsWith(url));

        if (Post != null)
        {
            var index = ContentService.Posts.IndexOf(Post);
            if (index > 0)
            {
                PreviousPost = ContentService.Posts[index - 1];
            }
            if (index < ContentService.Posts.Count - 1)
            {
                NextPost = ContentService.Posts[index + 1];
            }
        }
    }
}

