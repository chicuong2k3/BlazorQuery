﻿﻿
# Overview

BlazorQuery provides 3 Network Modes to control how **Queries** and **Mutations** behave 
when there is no network connection. You can set the network mode:
- Per query/mutation individually via `QueryOptions<T>.NetworkMode`.
- Globally via `QueryClient.DefaultNetworkMode`.

By default, queries use the `Online` network mode.

# Network Mode: Online

In `Online` mode:
- Queries and mutations execute **only when online**.
- If a fetch cannot happen, the query remains in its current state (`Loading`, `Error`, `Success`).
- An additional fetch status is available:
  - **Fetching**: the query function is actively executing.
  - **Paused**: the query is paused until network returns.
  - **Idle**: the query is neither fetching nor paused.

Convenience flags: `IsFetching` and `IsPaused`.

If a query is running and the network goes offline mid-fetch:
- The current fetch is **cancelled** and the query enters `Paused` state.
- Any pending retries are also **paused**.
- Execution resumes automatically once the connection returns.
- This is a **continue** operation, not a refetch — the query picks up from where it left off.
- If the query was cancelled in the meantime (e.g., component disposed), it will not continue.

**Important**: For your query function to respect network changes mid-execution,
use the `CancellationToken` provided in the context:

```csharp
var query = new UseQuery<Data>(
    new QueryOptions<Data>(
        queryKey: new("data"),
        queryFn: async ctx => {
            var (queryKey, signal) = ctx; // Get cancellation token
            var response = await httpClient.GetAsync(url, signal); // Pass it!
            return await response.Content.ReadFromJsonAsync<Data>(signal);
        }
    ),
    queryClient
);
```

**Platform Note**: Unlike React Query (browser), .NET HTTP requests cannot be paused 
mid-flight. They must be cancelled (via CancellationToken) or complete normally. 
The pause/continue mechanism works at the **retry level** - pausing between retry attempts,
not during the actual fetch operation.

`RefetchOnReconnect` defaults to `true` (stale queries will refetch when network reconnects). 

# Network Mode: Always

- Queries always fetch, ignoring network state. 
- Queries are never paused.
- Retries do not pause; the query will enter `Error` state if it fails.
- `RefetchOnReconnect` defaults to `false`.
- Useful for queries that do not require a live network such as reading from local cache or 
returning `Task.FromResult()` in `QueryFn`. 

> For this mode, `FetchStatus` is never set to `Paused`. It will always be either 
`Fetching` or `Idle`.

# Network Mode: OfflineFirst

`OfflineFirst` mode is a hybrid between `Online` and `Always`:
- The query executes once, then pauses retries if offline.
- Useful for offline-first scenarios such as service worker caching or HTTP cache.
- The first fetch may succeed from the cache, but if there's a cache miss and network fails, 
retries will behave like **Online**.


# Loading vs Fetching

BlazorQuery distinguishes between logical loading and active fetching:
- **IsFetching**: Indicates that the query function is actively executing (network request 
in progress). Equivalent to `FetchStatus == Fetching`.
- **IsLoading**: Indicates that the query is in a loading state without data yet. 
In React Query terms: `isLoading = isPending && (isFetching || isPaused)`. 
This means `IsLoading` is true when there's no data yet AND the query is either 
actively fetching or paused due to network conditions.

